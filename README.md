# Deep Feature Re-Identification and Health Check Endpoint

This project combines **YOLOv8** person detection/tracking with **ResNet50** deep features to create a complete person re-identification pipeline. The system first uses YOLOv8 for person tracking and counting to generate the dataset, then applies ResNet50 deep features to find and merge similar person folders (Re-ID).  
It includes a **Flask-based Health Monitor API** to track processing status and statistics in real time.

---

## Features

- **YOLOv8 Person Detection & Tracking**: Detects and tracks persons in video streams to create initial dataset
- **Person Counting**: Generates unique person folders with tracked person crops
- **Deep Feature Extraction**: Uses ResNet50 (`tensorflow.keras.applications.ResNet50`) for feature extraction
- Calculates cosine similarity between folders to identify duplicates/similar identities
- Backs up source folders before merging
- Live **Health Monitor API** to track:
  - Current merge operation and progress
  - Merge statistics and errors
  - List of detected person folders

---

## Requirements

- Python 3.8+
- Install dependencies:
  ```bash
  pip install numpy opencv-python tensorflow scikit-learn flask ultralytics
  ```

---

## Folder Structure

```
re-ID/
│
├── obj_counting.py   # YOLOv8 person detection and tracking script
├── deeplearningg_reID.py             # Main script for finding/merging similar folders
├── health_check.py       # Flask Health Monitor
├── persons/                       # Dataset generated by YOLOv8 tracking
│   ├── id_108.0/                 # Person folder with tracked crops
│   ├── id_200.0/
│   └── id_305.0/
├── videos                        # video mp4
└── README.md                      # This file
```

---

## Usage

### 1️) Generate Dataset with YOLOv8
First, run person detection and tracking to create your dataset:
```bash
python obj_counting.py
```
This will:
- Process video files from the `re-ID/` directory
- Use YOLOv8 to detect and track persons
- Save person crops to individual folders (e.g., `id_108.0`, `id_200.0`)
- Create the `persons/` directory structure

### 2️) Start the Health Monitor
Run in one terminal:
```bash
python health_check.py
```
This starts a Flask server at http://localhost:5001.

### 3️) Run the Re-ID Merge
In another terminal:
```bash
python deeplearningg_reID.py
```
- Enter `y` when prompted to merge folders
- Backups are saved in `persons/backup_before_merge`

### 4️) Check Health
Use curl to check:
```bash
curl http://localhost:5001/health/processing
```

---

## API Endpoints

### Health Monitor Endpoints

- **GET** `/health` - Basic system health and total person count
- **GET** `/health/processing` - Current processing status and progress
- **GET** `/health/reid` - Re-identification statistics and error logs
- **GET** `/health/persons` - List of all detected person folders

---

## How It Works

1. **Feature Extraction**: Uses ResNet50 pre-trained model to extract deep features from person images
2. **Similarity Calculation**: Computes cosine similarity between feature vectors of different folders
3. **Duplicate Detection**: Identifies folders with similarity above the threshold
4. **Safe Merging**: Creates backups before merging similar folders
5. **Real-time Monitoring**: Flask API provides live status updates

---

## Performance Notes

- **YOLOv8 Processing**: GPU acceleration recommended for real-time video processing
- **Tracking Accuracy**: Higher confidence thresholds reduce false detections but may miss some persons
- **Dataset Quality**: Better person crops from YOLOv8 improve Re-ID accuracy
- Processing time depends on dataset size and image count per folder
- ResNet50 feature extraction is GPU-accelerated if CUDA is available
- Backup creation ensures data safety during merge operations

---

## Acknowledgements

- [TensorFlow Keras](https://keras.io/)
- [Flask](https://flask.palletsprojects.com/)
- [scikit-learn](https://scikit-learn.org/)
- [Ultralytics YOLOv8](https://github.com/ultralytics/ultralytics)
